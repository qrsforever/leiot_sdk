# CMakeLists.txt

IF (NOT LEIOT_ENABLE_STATIC)
    ADD_COMPILE_OPTIONS ("-fPIC")
ENDIF ()

INCLUDE (${CMAKE_CURRENT_LIST_DIR}/tls/CMakeLists.txt)
INCLUDE (${CMAKE_CURRENT_LIST_DIR}/ota/CMakeLists.txt)
INCLUDE (${CMAKE_CURRENT_LIST_DIR}/shadow/CMakeLists.txt)
INCLUDE (${CMAKE_CURRENT_LIST_DIR}/security/CMakeLists.txt)
INCLUDE (${CMAKE_CURRENT_LIST_DIR}/mqtt-client/CMakeLists.txt)
INCLUDE (${CMAKE_CURRENT_LIST_DIR}/tcp-client/CMakeLists.txt)
INCLUDE (${CMAKE_CURRENT_LIST_DIR}/udp-client/CMakeLists.txt)
INCLUDE (${CMAKE_CURRENT_LIST_DIR}/access/CMakeLists.txt)
INCLUDE (${CMAKE_CURRENT_LIST_DIR}/import/CMakeLists.txt)
INCLUDE (${CMAKE_CURRENT_LIST_DIR}/platform/CMakeLists.txt)
INCLUDE (${CMAKE_CURRENT_LIST_DIR}/sdk-impl/CMakeLists.txt)
INCLUDE (${CMAKE_CURRENT_LIST_DIR}/sdk-tests/CMakeLists.txt)
INCLUDE (${CMAKE_CURRENT_LIST_DIR}/system/CMakeLists.txt)
INCLUDE (${CMAKE_CURRENT_LIST_DIR}/devices/CMakeLists.txt)

# Remove duplicated files
LIST (REMOVE_DUPLICATES LEIOT_C_SOURCES)
LIST (REMOVE_DUPLICATES LEIOT_INCLUDES)
LIST (REMOVE_DUPLICATES LEIOT_LIBRARIES)
LIST (REMOVE_DUPLICATES LEIOT_DEFINITIONS)

IF (NOT LEIOT_ENABLE_STATIC)
    ADD_LIBRARY (${LEIOT_SDK_NAME} SHARED ${LEIOT_C_SOURCES})    
ELSE ()
    ADD_LIBRARY (${LEIOT_SDK_NAME} STATIC ${LEIOT_C_SOURCES})    
ENDIF ()

# Add the include directories to the INCLUDE_DIRECTORIES
FOREACH (INC ${LEIOT_INCLUDES})
    LEIOT_CMAKE_ECHO ("Add INC: ${INC}")
    INCLUDE_DIRECTORIES (${INC})
ENDFOREACH (INC)
SET_PROPERTY (GLOBAL APPEND PROPERTY GLOBAL_INCLUDES ${LEIOT_INCLUDES} ) 

# Add the definitions to the ADD_DEFINITIONS
FOREACH (DEF ${LEIOT_DEFINITIONS})
    LEIOT_CMAKE_ECHO ("Add DEF: ${DEF}")
    ADD_DEFINITIONS (${DEF})
ENDFOREACH (DEF)
SET_PROPERTY (GLOBAL APPEND PROPERTY GLOBAL_DEFINITIONS ${LEIOT_DEFINITIONS} ) 

# Add the libraries to the TARGET_LINK_LIBRARIES
FOREACH (LDS ${LEIOT_LIBRARIES})
    LEIOT_CMAKE_ECHO ("Add LDS: ${LDS}")
    TARGET_LINK_LIBRARIES (${LEIOT_SDK_NAME} ${LDS})
ENDFOREACH (LDS)
