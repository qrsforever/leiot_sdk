# external/CMakeLists.txt

INCLUDE (DownloadCodes)

IF (LEIOT_ENABLE_TLS)
    SET (TLS_GIT_DIR "mbedtls")
    SET (TLS_GIT_TAG "mbedtls-2.6.0")
    SET (TLS_GIT_URL "https://github.com/ARMmbed/mbedtls")
    # LEIOT_GIT_CLONE (${TLS_GIT_DIR} ${TLS_GIT_TAG} ${TLS_GIT_URL} ${PROJECT_EXTERNAL_DIR})
    LEIOT_WGET_ARCHIVE (${TLS_GIT_DIR} ${TLS_GIT_TAG} ${TLS_GIT_URL} ${PROJECT_EXTERNAL_DIR})

    # LEIOT_FILTER_OUT (TLS_CFLAGS PLATFORM_CFLAGS "-ansi")

    SET (MODULE_TLS_NAME "mbedtls")
    SET (TLS_PACK_DIR "${PROJECT_EXTERNAL_DIR}/${TLS_GIT_DIR}")

    FILE (GLOB_RECURSE TLS_C_SOURCES "${TLS_PACK_DIR}/library/*.c")
    ADD_LIBRARY (${MODULE_TLS_NAME} STATIC ${TLS_C_SOURCES})
    TARGET_INCLUDE_DIRECTORIES (${MODULE_TLS_NAME} PRIVATE ${TLS_PACK_DIR}/include)
    # TARGET_COMPILE_OPTIONS (${MODULE_TLS_NAME} PRIVATE ${TLS_CFLAGS})

    LEIOT_GLOBAL_APPEND (GLOBAL_INCLUDE_DIR ${TLS_PACK_DIR}/include)
    LEIOT_GLOBAL_APPEND (GLOBAL_STATIC_LIBS ${MODULE_TLS_NAME})

    # Debug
    LEIOT_TARGET_COMPILE_INFO (${MODULE_TLS_NAME})
ENDIF (LEIOT_ENABLE_TLS)

IF (LEIOT_ENABLE_MQTT)
    SET (MQTT_GIT_DIR "paho.mqtt.embedded-c")
    SET (MQTT_GIT_TAG "v1.1.0")
    SET (MQTT_GIT_URL "https://github.com/eclipse/paho.mqtt.embedded-c")
    # LEIOT_GIT_CLONE ("${MQTT_GIT_DIR}" ${MQTT_GIT_TAG} ${MQTT_GIT_URL} ${PROJECT_EXTERNAL_DIR})
    LEIOT_WGET_ARCHIVE (${MQTT_GIT_DIR} ${MQTT_GIT_TAG} ${MQTT_GIT_URL} ${PROJECT_EXTERNAL_DIR})

    # LEIOT_FILTER_OUT (MQTT_CFLAGS PLATFORM_CFLAGS "-Werror")

    SET (MODULE_MQTT_NAME "MQTTPacketClient")
    SET (MQTT_PACK_DIR "${PROJECT_EXTERNAL_DIR}/${MQTT_GIT_DIR}/MQTTPacket/src")
    ADD_LIBRARY (${MODULE_MQTT_NAME} STATIC
        ${MQTT_PACK_DIR}/MQTTFormat.c
        ${MQTT_PACK_DIR}/MQTTPacket.c
        ${MQTT_PACK_DIR}/MQTTSerializePublish.c
        ${MQTT_PACK_DIR}/MQTTDeserializePublish.c
        ${MQTT_PACK_DIR}/MQTTConnectClient.c
        ${MQTT_PACK_DIR}/MQTTSubscribeClient.c
        ${MQTT_PACK_DIR}/MQTTUnsubscribeClient.c
        )
    TARGET_COMPILE_DEFINITIONS(${MODULE_MQTT_NAME} PRIVATE MQTT_CLIENT)
    # TARGET_COMPILE_OPTIONS (${MODULE_MQTT_NAME} PRIVATE ${MQTT_CFLAGS})

    LEIOT_GLOBAL_APPEND (GLOBAL_INCLUDE_DIR ${MQTT_PACK_DIR})
    LEIOT_GLOBAL_APPEND (GLOBAL_STATIC_LIBS ${MODULE_MQTT_NAME})

    # Debug
    LEIOT_TARGET_COMPILE_INFO (${MODULE_MQTT_NAME})
ENDIF (LEIOT_ENABLE_MQTT)
